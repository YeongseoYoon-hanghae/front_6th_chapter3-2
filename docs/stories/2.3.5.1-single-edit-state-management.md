# Story 2.3.5.1: 단일 수정 모드 상태 관리 개선

## Status

Ready for Development

## Story

**As a** 개발자,  
**I want** 반복 일정의 단일 수정 모드를 구분할 수 있는 상태 관리 시스템을,  
**so that** 폼 로딩과 제출 로직에서 적절한 처리를 할 수 있다.

## Problem Statement

현재 반복 일정을 단일 수정할 때와 일반 일정을 수정할 때를 구분할 수 없어서:

1. 폼 로딩 시점에 `convertToSingleEvent`가 즉시 실행됨
2. 제출 시점에 단일 전환 여부를 판단할 수 없음
3. UI에서 단일 수정 모드임을 사용자에게 알릴 수 없음

## Acceptance Criteria

1. **단일 수정 플래그 추가** - `useEditingState`에 `isSingleEdit` 상태 추가
2. **단일 수정 시작 함수** - `startSingleEdit` 함수로 단일 수정 모드 진입
3. **상태 초기화** - 편집 종료 시 모든 상태 정리
4. **타입 안전성** - TypeScript 타입 정의 완료
5. **기존 호환성** - 기존 편집 로직에 영향 없음

## Technical Solution

### useEditingState 훅 확장

```typescript
// src/hooks/useEditingState.ts

interface EditingState {
  editingEvent: Event | null;
  isEditing: boolean;
  isSingleEdit: boolean; // 새로 추가
}

export const useEditingState = () => {
  const [editingEvent, setEditingEvent] = useState<Event | null>(null);
  const [isSingleEdit, setIsSingleEdit] = useState(false);

  const isEditing = editingEvent !== null;

  // 일반 편집 시작
  const startEdit = (event: Event) => {
    setEditingEvent(event);
    setIsSingleEdit(false);
  };

  // 단일 편집 시작 (새로 추가)
  const startSingleEdit = (event: Event) => {
    setEditingEvent(event);
    setIsSingleEdit(true);
  };

  // 편집 종료
  const stopEditing = () => {
    setEditingEvent(null);
    setIsSingleEdit(false);
  };

  return {
    editingEvent,
    isEditing,
    isSingleEdit,
    startEdit,
    startSingleEdit,
    stopEditing,
  };
};
```

## Implementation Tasks

- [ ] **타입 정의 업데이트**

  - [ ] `EditingState` 인터페이스에 `isSingleEdit` 추가
  - [ ] 훅 반환 타입 업데이트

- [ ] **상태 관리 로직 구현**

  - [ ] `isSingleEdit` useState 추가
  - [ ] `startSingleEdit` 함수 구현
  - [ ] `stopEditing` 함수에 플래그 리셋 로직 추가

- [ ] **기존 코드 호환성 확인**
  - [ ] 기존 `startEdit` 함수 동작 유지
  - [ ] 기존 편집 플로우 영향 없음 확인

## Test Cases

### Test 1: 일반 편집 모드

```typescript
test('일반 편집 모드에서는 isSingleEdit이 false', () => {
  const { result } = renderHook(() => useEditingState());

  act(() => {
    result.current.startEdit(mockEvent);
  });

  expect(result.current.isSingleEdit).toBe(false);
  expect(result.current.isEditing).toBe(true);
});
```

### Test 2: 단일 편집 모드

```typescript
test('단일 편집 모드에서는 isSingleEdit이 true', () => {
  const { result } = renderHook(() => useEditingState());

  act(() => {
    result.current.startSingleEdit(mockRecurringEvent);
  });

  expect(result.current.isSingleEdit).toBe(true);
  expect(result.current.isEditing).toBe(true);
});
```

### Test 3: 편집 종료

```typescript
test('편집 종료 시 모든 상태가 초기화됨', () => {
  const { result } = renderHook(() => useEditingState());

  act(() => {
    result.current.startSingleEdit(mockRecurringEvent);
  });

  act(() => {
    result.current.stopEditing();
  });

  expect(result.current.isSingleEdit).toBe(false);
  expect(result.current.isEditing).toBe(false);
  expect(result.current.editingEvent).toBe(null);
});
```

## Definition of Done

- [ ] `useEditingState` 훅에 `isSingleEdit` 상태 추가됨
- [ ] `startSingleEdit` 함수 구현 완료
- [ ] 모든 단위 테스트 통과
- [ ] 기존 편집 플로우에 영향 없음 확인
- [ ] TypeScript 타입 체크 통과
- [ ] 코드 리뷰 완료

## Dependencies

**전제 조건:**

- 기존 `useEditingState` 훅 구현 완료

**다음 스토리:**

- Story 2.3.5.2 (폼 로딩 로직 수정)
- Story 2.3.5.3 (제출 로직 개선)

## Estimated Effort

**개발 시간:** 2-3시간  
**테스트 시간:** 1-2시간  
**총 예상 시간:** 3-5시간

## Notes

이 스토리는 후속 스토리들의 기반이 되는 중요한 상태 관리 개선입니다. 기존 코드에 최소한의 영향을 주면서 새로운 기능을 지원할 수 있도록 설계했습니다.

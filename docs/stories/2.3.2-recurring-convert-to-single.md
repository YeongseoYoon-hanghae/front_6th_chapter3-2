# Story 2.3.2: 반복→단일 전환 로직

## Status

Draft

## Scope

- 반복 이벤트를 단일 이벤트로 전환하는 로직 구현

## Acceptance Criteria

1. `repeat.type`을 `none`으로 설정한다
2. `repeat.id`를 제거한다
3. 전환 후 반복 아이콘이 표시되지 않는다
4. 동일 `repeat.id`의 다른 인스턴스는 영향을 받지 않는다
5. 확인 다이얼로그에서 취소하면 어떤 변경도 발생하지 않는다

## Tasks

- [x] `convertToSingleEvent(event)` 구현
- [x] 전환 후 편집 폼/상태 반영
- [x] 회귀 테스트(다른 이벤트 영향 없음)

## Dev Notes

- 유틸 위치: `src/utils/recurringUtils.ts`
- 불변성 유지하여 상태 업데이트
- 전환 주체: 클라이언트(`convertToSingleEvent`)에서 전환 후 저장 시 서버에도 단일로 반영
- 저장 계층은 전환된 이벤트에 `repeat.id`를 다시 주입하지 않아야 함(계약 확인)

## Testing

- [x] 단위: `convertToSingleEvent` 결과가 `type='none'`, `interval=0`, `repeat.id` 미포함이며 원본은 불변
- [x] 통합: "이 일정만 수정" 선택 시 폼의 반복 필드 비노출/비활성, 저장 후 해당 이벤트만 아이콘 미표시
- [x] 통합: 동일 그룹의 다른 이벤트는 반복 아이콘 유지(무영향)
- [x] 통합: 다이얼로그 취소 시 폼/아이콘/상태 변화 없음

## Links

- Parent: [2.3 반복 일정 단일 수정](./2.3.recurring-event-single-edit.md)

## QA Results

### Review Date: 2024-12-19

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

코어 기능인 `convertToSingleEvent` 함수가 올바르게 구현되어 있으며, 모든 Acceptance Criteria가 충족되었습니다. 불변성 보장, 타입 안전성, 그리고 UI 통합이 모두 적절히 처리되었습니다. 단위 테스트와 통합 테스트 모두 핵심 시나리오를 충분히 커버합니다.

### Refactoring Performed

작은 개선 사항들이 있지만 현재 구현은 프로덕션 준비 상태입니다. 별도의 리팩터링은 수행하지 않았습니다.

### Compliance Check

- Coding Standards: ✓ 함수명, 변수명, 타입 사용이 프로젝트 표준에 부합
- Project Structure: ✓ utils 디렉터리에 올바르게 배치됨
- Testing Strategy: ✓ 단위 테스트와 통합 테스트 모두 구현됨
- All ACs Met: ✓ 5개 Acceptance Criteria 모두 구현 및 검증됨

### Improvements Checklist

모든 주요 요구사항이 구현되었습니다:

- [x] convertToSingleEvent 함수 구현 완료 (src/utils/recurringUtils.ts)
- [x] 단위 테스트 구현 완료 (src/**tests**/unit/recurringUtils.spec.ts)
- [x] 통합 테스트 구현 완료 (src/**tests**/medium.integration.spec.tsx)
- [x] RecurringEditDialog 통합 완료 (src/App.tsx)
- [ ] 고려사항: 타입 단언 대신 더 안전한 타입 가드 사용 검토
- [ ] 고려사항: 에러 시나리오 테스트 추가 (invalid event 객체 등)

### Security Review

데이터 변환 로직으로 보안 이슈는 없습니다. 사용자 입력 검증은 상위 컴포넌트에서 처리되며, 불변성이 보장되어 예상치 못한 사이드 이펙트가 없습니다.

### Performance Considerations

단순한 객체 스프레드와 프로퍼티 삭제로 성능 영향은 미미합니다. 대용량 배치 처리에도 적합합니다.

### Files Modified During Review

리뷰 중 수정된 파일 없음.

### Gate Status

Gate: PASS → docs/qa/gates/2.3.2-recurring-convert-to-single.yml

### Recommended Status

✓ Ready for Done - 모든 Acceptance Criteria가 구현되고 테스트되었습니다.
(Story owner decides final status)

# Story 2.3: 반복 일정 단일 수정

## Status

Draft

## Story

**As a** 캘린더 사용자,
**I want** 반복 일정 중 하나만 수정할 수 있고,
**so that** 특정 날짜의 일정만 변경이 필요할 때 유연하게 대응할 수 있다.

## Acceptance Criteria

1. 반복 일정 수정 시 해당 인스턴스가 단일 일정으로 전환된다
2. 반복 아이콘이 자동으로 제거된다
3. 기존 PUT API를 활용하여 수정된다
4. 나머지 반복 일정들은 영향받지 않는다
5. 수정 완료 시 적절한 피드백이 제공된다

## Tasks / Subtasks

- [ ] **반복 일정 수정 감지 로직 구현** (AC: 1)

  - [ ] 반복 일정 클릭 시 수정 모드 진입 감지
  - [ ] 기존 이벤트 폼에 반복 일정 데이터 로드
  - [ ] 반복 일정 수정 확인 다이얼로그 구현
  - [ ] "이 일정만 수정" 옵션 제공

- [ ] **반복→단일 전환 로직 구현** (AC: 1,2)

  - [ ] repeat.id 필드 제거 로직
  - [ ] repeat.type을 'none'으로 설정
  - [ ] 반복 아이콘 자동 제거 처리
  - [ ] 수정된 일정의 독립성 보장

- [ ] **기존 PUT API 활용** (AC: 3)

  - [ ] PUT `/api/events/:id` 엔드포인트 활용
  - [ ] 수정된 Event 객체 생성 및 전송
  - [ ] API 응답 처리 및 에러 핸들링
  - [ ] 네트워크 오류 시 롤백 처리

- [ ] **반복 그룹 무결성 보장** (AC: 4)
  - [ ] 나머지 반복 일정들의 repeat.id 유지
  - [ ] 반복 그룹 내 다른 일정들 영향도 검증
  - [ ] 데이터 일관성 검증 로직
  - [ ] 캘린더 뷰 즉시 업데이트

## Dev Notes

### 기술적 구현 세부사항

**반복 일정 수정 감지:**

```typescript
// useEventOperations 확장
const handleEditRecurringEvent = async (event: Event) => {
  // 반복 일정인지 확인
  if (event.repeat.id && event.repeat.type !== 'none') {
    const userChoice = await showRecurringEditDialog();

    if (userChoice === 'single') {
      return editSingleInstance(event);
    } else if (userChoice === 'all') {
      // 추후 Story 3.2에서 구현
      return editAllInstances(event);
    }
  } else {
    // 일반 단일 일정 수정
    return editSingleEvent(event);
  }
};
```

**반복→단일 전환 로직:**

```typescript
// src/utils/recurringUtils.ts 확장
export const convertToSingleEvent = (recurringEvent: Event): Event => {
  return {
    ...recurringEvent,
    repeat: {
      type: 'none',
      interval: 1,
      endCondition: 'date',
      // repeat.id 제거 (undefined로 설정)
      id: undefined,
    },
  };
};
```

**반복 수정 확인 다이얼로그:**

```typescript
// src/components/RecurringEditDialog.tsx (새로 생성)
import {
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  Button,
  Typography,
} from '@mui/material';

interface RecurringEditDialogProps {
  open: boolean;
  event: Event;
  onConfirm: (choice: 'single' | 'all' | 'cancel') => void;
}

export const RecurringEditDialog: React.FC<RecurringEditDialogProps> = ({
  open,
  event,
  onConfirm,
}) => {
  const repeatTypeText = {
    daily: '매일',
    weekly: '매주',
    monthly: '매월',
    yearly: '매년',
  }[event.repeat.type];

  return (
    <Dialog open={open} maxWidth="sm" fullWidth>
      <DialogTitle>반복 일정 수정</DialogTitle>
      <DialogContent>
        <Typography variant="body1" gutterBottom>
          "{event.title}"는 {repeatTypeText} 반복되는 일정입니다.
        </Typography>
        <Typography variant="body2" color="textSecondary">
          어떻게 수정하시겠습니까?
        </Typography>
      </DialogContent>
      <DialogActions>
        <Button onClick={() => onConfirm('cancel')} color="secondary">
          취소
        </Button>
        <Button onClick={() => onConfirm('single')} variant="contained" color="primary">
          이 일정만 수정
        </Button>
        <Button
          onClick={() => onConfirm('all')}
          variant="outlined"
          color="primary"
          disabled // Story 3.2에서 구현 예정
        >
          전체 반복 일정 수정 (추후 지원)
        </Button>
      </DialogActions>
    </Dialog>
  );
};
```

## Change Log

| 날짜       | 변경 사항           | 작성자 |
| ---------- | ------------------- | ------ |
| 2024-12-19 | Story 2.3 초기 생성 | PO     |

## Dependencies

**전제 조건:**

- Story 2.1 (반복 일정 생성) 완료
- Story 2.2 (반복 일정 시각적 구분) 완료 (아이콘 제거 확인용)
- 기존 PUT `/api/events/:id` API 정상 동작

# 주간 반복 요일 선택 기능 Brownfield Enhancement PRD

## 프로젝트 분석 및 컨텍스트

### 기존 프로젝트 개요

#### 분석 소스

IDE 기반 신규 분석

#### 현재 프로젝트 상태

제공된 문서 분석을 바탕으로, 이 프로젝트는 React 19 + TypeScript 기반의 캘린더 애플리케이션입니다. 현재 반복 일정 기능이 이미 구현되어 있으며, 주간 반복은 단순히 7일 간격으로 계산되고 있습니다. 주간 반복 시 특정 요일을 선택할 수 있는 기능을 추가하려고 합니다.

### 사용 가능한 문서 분석

#### 사용 가능한 문서

- ✅ 기술 스택 문서 (weekday-selection-frontend-architecture.md에서 확인)
- ✅ 소스 트리/아키텍처 분석 완료
- ✅ 코딩 표준 (메모리에서 확인된 선언적 접근 방식 선호)
- ✅ API 문서 부분적 가용
- ✅ 외부 API 문서
- ✅ UX/UI 가이드라인 (Material-UI 7.2.0 사용 확인)
- ✅ 기술 부채 문서 부분적 가용

### 향상 기능 범위 정의

#### 향상 기능 타입

- ✅ 새로운 기능 추가
- ☐ 주요 기능 수정
- ☐ 새로운 시스템과의 통합
- ☐ 성능/확장성 개선
- ☐ UI/UX 개편
- ☐ 기술 스택 업그레이드
- ☐ 버그 수정 및 안정성 개선

#### 향상 기능 설명

주간 반복 일정 생성 시 특정 요일(월, 수, 금 등)을 선택할 수 있는 기능을 추가합니다. 사용자는 "매주 월, 수, 금요일에 운동"과 같은 복잡한 반복 패턴을 쉽게 설정할 수 있게 됩니다.

#### 영향 평가

- ☐ 최소 영향 (격리된 추가 기능)
- ✅ 보통 영향 (일부 기존 코드 변경)
- ☐ 상당한 영향 (상당한 기존 코드 변경)
- ☐ 주요 영향 (아키텍처 변경 필요)

### 목표와 배경 컨텍스트

#### 목표

• 주간 반복 시 복수 요일 선택 기능 제공
• 기존 단순 주간 반복과의 완전한 호환성 유지
• 직관적이고 접근성이 좋은 요일 선택 UI 구현
• 확장 가능한 구조로 향후 월간 옵션 등 추가 기능 지원

#### 배경 컨텍스트

현재 시스템은 주간 반복을 단순히 7일 간격으로 계산하여 매주 같은 요일에만 반복됩니다. 하지만 사용자들은 "매주 월, 수, 금요일에 운동" 또는 "매주 주말에 가족 시간" 같은 더 유연한 반복 패턴을 원합니다. 이 기능은 기존 반복 일정 시스템을 확장하여 사용자에게 더 정밀한 일정 관리 도구를 제공합니다.

#### 변경 로그

| 변경          | 날짜       | 버전 | 설명                              | 작성자    |
| ------------- | ---------- | ---- | --------------------------------- | --------- |
| 초기 PRD 작성 | 2024-12-19 | v1.0 | 주간 반복 요일 선택 기능 PRD 생성 | John (PM) |

## 요구사항

### 기능 요구사항

- **FR1**: 주간 반복 선택 시 사용자가 특정 요일들을 복수 선택할 수 있는 체크박스 UI가 제공되어야 합니다.
- **FR2**: 요일 선택 시 최소 1개 이상의 요일이 선택되어야 하며, 선택되지 않은 경우 검증 오류를 표시해야 합니다.
- **FR3**: 선택된 요일들만 반복 일정이 생성되어야 하며, 선택되지 않은 요일은 제외되어야 합니다.
- **FR4**: 기존 단순 주간 반복 일정(weeklyOptions 없는 경우)은 수정 없이 기존 방식대로 동작해야 합니다.
- **FR5**: 요일 선택 UI는 한국어로 일, 월, 화, 수, 목, 금, 토 순서로 표시되어야 합니다.
- **FR6**: 반복 종류를 주간에서 다른 타입으로 변경 시 요일 선택 상태가 초기화되어야 합니다.

### 비기능 요구사항

- **NFR1**: 기존 반복 일정 계산 성능을 유지해야 하며, 요일 선택 기능 추가로 인한 성능 저하는 20% 이하여야 합니다.
- **NFR2**: Material-UI 7.2.0 컴포넌트(Checkbox, FormGroup 등)를 활용하여 기존 UI 일관성을 유지해야 합니다.
- **NFR3**: 키보드 네비게이션과 스크린 리더를 지원하는 웹 접근성 기준(WCAG 2.1 AA)을 충족해야 합니다.
- **NFR4**: 모바일 디바이스에서도 사용하기 쉬운 반응형 디자인을 제공해야 합니다.
- **NFR5**: TypeScript 타입 안정성을 유지하며 any 타입 사용을 금지해야 합니다.

### 호환성 요구사항

- **CR1**: 기존 RepeatInfo API와 완전히 호환되어야 하며, weeklyOptions는 선택적 필드로 추가되어야 합니다.
- **CR2**: 기존 데이터베이스 스키마를 변경하지 않고 JSON 필드 내에 weeklyOptions를 저장해야 합니다.
- **CR3**: 현재 Material-UI 디자인 시스템과 완전히 일치하는 UI 일관성을 유지해야 합니다.
- **CR4**: 기존 이벤트 생성/수정 플로우와 매끄럽게 통합되어야 하며, 새로운 단계나 페이지를 추가하지 않아야 합니다.

## 사용자 인터페이스 향상 목표

### 기존 UI와의 통합

새로운 요일 선택 UI는 현재 RepeatSection 컴포넌트 내에 조건부로 표시되며, Material-UI의 FormGroup과 Checkbox 컴포넌트를 활용하여 기존 디자인 시스템과 완벽히 일치합니다. 선언적 구조를 유지하며 WeeklyDaysSelector라는 별도 컴포넌트로 분리하여 재사용성과 테스트 가능성을 확보합니다.

### 수정/신규 화면 및 뷰

- **RepeatSection 컴포넌트**: 주간 반복 선택 시 요일 선택 UI 추가
- **WeeklyDaysSelector 컴포넌트**: 새로 생성되는 요일 선택 전용 컴포넌트

### UI 일관성 요구사항

- Material-UI 7.2.0의 Checkbox, FormGroup, FormLabel 컴포넌트 사용
- 기존 RepeatSection의 Stack 레이아웃과 spacing 패턴 유지
- 반응형 디자인으로 모바일에서는 세로 배치, 데스크톱에서는 가로 배치
- 기존 폼 검증 스타일과 일치하는 오류 메시지 표시

## 기술적 제약사항 및 통합 요구사항

### 기존 기술 스택

**언어**: TypeScript, JavaScript
**프레임워크**: React 19, Vite
**데이터베이스**: JSON 기반 로컬 스토리지
**인프라**: 웹 기반 SPA
**외부 종속성**: Material-UI 7.2.0, Testing Library, Vitest

### 통합 접근 방식

**데이터베이스 통합 전략**: 기존 RepeatInfo 구조에 weeklyOptions 옵셔널 필드 추가, 하위 호환성 보장
**API 통합 전략**: 기존 이벤트 생성/수정 API는 변경 없이 RepeatInfo 확장 구조 지원
**프론트엔드 통합 전략**: RepeatSection 컴포넌트 확장, 조건부 렌더링으로 기존 UI 플로우 유지
**테스트 통합 전략**: 기존 단위 테스트에 weeklyOptions 케이스 추가, 새로운 통합 테스트 작성

### 코드 조직 및 표준

**파일 구조 접근 방식**: 기존 src/components, src/utils, src/types 구조 유지
**명명 규칙**: 기존 camelCase 규칙 유지, WeeklyOptions, WeeklyDaysSelector 등
**코딩 표준**: 선언적 컴포넌트 구조, TypeScript strict 모드, any 타입 금지
**문서화 표준**: JSDoc 주석, README 업데이트, 아키텍처 문서 갱신

### 배포 및 운영

**빌드 프로세스 통합**: 기존 Vite 빌드 프로세스 유지, 추가 의존성 없음
**배포 전략**: 기존 정적 배포 방식 유지, 점진적 기능 롤아웃
**모니터링 및 로깅**: 기존 브라우저 기반 로깅 유지, 새로운 기능 사용 추적
**구성 관리**: 기존 환경 변수 구조 유지, 새로운 설정 없음

### 위험 평가 및 완화

**기술적 위험**: TypeScript 타입 안정성 유지, 기존 recurringUtils.ts 로직 확장 시 부작용 방지
**통합 위험**: RepeatInfo 구조 변경으로 인한 기존 기능 영향, 철저한 회귀 테스트 필요
**배포 위험**: 브라우저 호환성 유지, Material-UI 컴포넌트 의존성 관리
**완화 전략**: 단계별 구현, 기능 플래그 활용, 롤백 계획 수립

## 에픽 및 스토리 구조

### 에픽 접근 방식

**에픽 구조 결정**: 단일 에픽으로 구성하여 주간 반복 요일 선택 기능의 응집성을 유지하고, 기존 시스템과의 통합 위험을 최소화합니다.

## 에픽 1: 주간 반복 요일 선택 기능

**에픽 목표**: 사용자가 주간 반복 일정 생성 시 특정 요일들을 선택할 수 있는 기능을 추가하여, 더 유연하고 정밀한 반복 일정 관리를 제공합니다.

**통합 요구사항**: 기존 RepeatInfo 구조와 반복 일정 계산 로직을 확장하되, 하위 호환성을 완전히 보장하여 기존 기능에 영향을 주지 않습니다.

### 스토리 1.1: 타입 정의 및 데이터 모델 확장

As a 개발자,
I want RepeatInfo 타입에 weeklyOptions 필드를 추가하고 관련 타입을 정의할 수 있다,
so that 주간 반복 요일 선택 기능의 기반 데이터 구조를 구축할 수 있다.

#### 수락 기준

1. WeeklyOptions 인터페이스가 daysOfWeek: number[] 필드를 포함하여 정의된다
2. RepeatInfo 타입에 weeklyOptions?: WeeklyOptions 옵셔널 필드가 추가된다
3. 기존 RepeatInfo 객체들이 수정 없이 정상 동작한다
4. TypeScript 컴파일 오류가 발생하지 않는다

#### 통합 검증

- **IV1**: 기존 반복 일정 생성 기능이 weeklyOptions 없이 정상 동작함을 확인
- **IV2**: 새로운 타입 정의가 기존 코드와 충돌하지 않음을 확인
- **IV3**: 타입 추가로 인한 성능 영향이 없음을 확인

### 스토리 1.2: 주간 요일별 날짜 계산 로직 구현

As a 개발자,
I want 선택된 요일들만 포함하는 주간 반복 날짜를 계산할 수 있다,
so that 사용자가 선택한 특정 요일에만 일정이 생성될 수 있다.

#### 수락 기준

1. calculateWeeklyWithSpecificDays 함수가 구현되어 선택된 요일만 계산한다
2. calculateRecurringDatesWithOptions 함수가 weeklyOptions 지원을 추가한다
3. 기존 calculateRecurringDates 함수는 변경 없이 유지된다
4. 단위 테스트가 모든 요일 조합에 대해 통과한다

#### 통합 검증

- **IV1**: 기존 주간 반복 계산이 weeklyOptions 없이 기존 방식대로 동작함을 확인
- **IV2**: 새로운 계산 로직이 기존 성능 특성을 유지함을 확인
- **IV3**: 다양한 요일 조합에서 정확한 날짜가 계산됨을 확인

### 스토리 1.3: WeeklyDaysSelector UI 컴포넌트 개발

As a 사용자,
I want 주간 반복 선택 시 원하는 요일들을 체크박스로 선택할 수 있다,
so that 내가 원하는 특정 요일에만 반복 일정을 만들 수 있다.

#### 수락 기준

1. WeeklyDaysSelector 컴포넌트가 7개 요일 체크박스를 제공한다
2. 체크박스는 일, 월, 화, 수, 목, 금, 토 순서로 한국어로 표시된다
3. 최소 1개 요일 선택 검증이 구현된다
4. Material-UI FormGroup과 Checkbox를 사용한다
5. 키보드 네비게이션과 스크린 리더를 지원한다

#### 통합 검증

- **IV1**: 기존 RepeatSection UI 스타일과 일관성이 유지됨을 확인
- **IV2**: 모바일과 데스크톱에서 반응형 레이아웃이 정상 동작함을 확인
- **IV3**: 접근성 기준(WCAG 2.1 AA)을 충족함을 확인

### 스토리 1.4: RepeatSection 컴포넌트 통합 및 상태 관리

As a 사용자,
I want 반복 타입을 주간으로 선택하면 자동으로 요일 선택 UI가 나타난다,
so that 직관적으로 주간 반복 요일을 설정할 수 있다.

#### 수락 기준

1. repeatType이 'weekly'일 때 WeeklyDaysSelector가 조건부 렌더링된다
2. 반복 타입 변경 시 weeklyOptions 상태가 적절히 초기화된다
3. 폼 제출 시 weeklyOptions가 RepeatInfo에 포함된다
4. 기존 RepeatSection의 레이아웃과 스타일이 유지된다

#### 통합 검증

- **IV1**: 기존 반복 설정 플로우가 변경 없이 동작함을 확인
- **IV2**: 주간 이외 반복 타입 선택 시 요일 선택 UI가 표시되지 않음을 확인
- **IV3**: 폼 상태 관리가 기존 패턴과 일관성을 유지함을 확인

### 스토리 1.5: 통합 테스트 및 기존 기능 검증

As a QA 엔지니어,
I want 새로운 주간 요일 선택 기능이 기존 반복 일정 기능과 완벽히 호환된다,
so that 기존 사용자의 일정이 영향받지 않고 새로운 기능을 안전하게 제공할 수 있다.

#### 수락 기준

1. 기존 반복 일정(weeklyOptions 없음)이 정상 동작한다
2. 새로운 요일 선택 기능이 모든 시나리오에서 정확히 동작한다
3. E2E 테스트가 전체 사용자 플로우를 검증한다
4. 성능 테스트가 NFR1 기준(20% 이하 성능 저하)을 충족한다

#### 통합 검증

- **IV1**: 기존 사용자 데이터와 일정이 마이그레이션 없이 정상 동작함을 확인
- **IV2**: 새로운 기능과 기존 기능 간 상호작용에서 충돌이 없음을 확인
- **IV3**: 전체 애플리케이션의 안정성과 성능이 유지됨을 확인

---

이 PRD는 기존 시스템의 무결성을 유지하면서 주간 반복 요일 선택 기능을 안전하게 추가하는 로드맵을 제공합니다. 각 스토리는 점진적으로 기능을 구축하며, 기존 기능에 대한 위험을 최소화하는 순서로 설계되었습니다.
